@palette=false
public class MiddlewareServiceTest extends Test
{
  
  static void testConnect() 
  {
    App.log.message("@@@ NOTE: the MQTT kit test needs a local MQTT broker(mosquitto recommended) installed and listen at localhost:1883 @@@")
    //set up service first
    App a = Sys.app
    MiddlewareService s = (MiddlewareService)a.add(a, "mqtt", MiddlewareService.type)
    
    s.host.copyFromStr("localhost")
    s.clientid.copyFromStr("MqttTest")
    s.connect()
    assert(s.status == MiddlewareService.Connected)

    MqttTestComponent c1 = (MqttTestComponent)a.add(s, "c1", MqttTestComponent.type)

    assert(MiddlewareService.getRegisteredSlotCount(s.getHandle()) == 4)
    assert(MiddlewareService.isComponentRegistered(s.getHandle(), c1) == true)
    // NULL value
    assert(MiddlewareService.isComponentRegistered(s.getHandle(), null) == false)

    assert(MiddlewareService.isSlotRegistered(s.getHandle(), c1, MqttTestComponent.type.findSlot("enabled")) == true)
    // Unknown slot -> false
    assert(MiddlewareService.isSlotRegistered(s.getHandle(), c1, MqttTestComponent.type.findSlot("hysteresis")) == false)
    // Unregistered slot -> false
    assert(MiddlewareService.isSlotRegistered(s.getHandle(), c1, MqttTestComponent.type.findSlot("hysteresis")) == false)
    // NULL value
    assert(MiddlewareService.isSlotRegistered(s.getHandle(), null, MqttTestComponent.type.findSlot("enabled")) == false)

    s.restartScan()

    assert(MiddlewareService.getRegisteredSlotCount(s.getHandle()) == 0)
    assert(s.registeredSlots == 0)

    s.disconnect()
    assert(s.status == MiddlewareService.Disconnected)
  }
}
